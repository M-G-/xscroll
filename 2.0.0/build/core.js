KISSY.add('kg/xscroll/2.0.0/core',["./util","./event","./pan","./tap","./pinch","./scrollbar","./pulldown","./swipeedit"],function(S ,require, exports, module) {define(function(t){function e(t,e){return[[(t/3+(t+e)/3-t)/(e-t),(t*t/3+t*e*2/3-t*t)/(e*e-t*t)],[(e/3+(t+e)/3-t)/(e-t),(e*e/3+t*e*2/3-t*t)/(e*e-t*t)]]}var n=window,i=t("./util"),r=t("./event"),o=t("./pan"),a=t("./tap"),s=t("./pinch"),c=t("./scrollbar"),l=t("./pulldown"),f=(t("./swipeedit"),function(t){this.userConfig=t,this.init()});f.PullDown=l,f.version="1.0.0";for(var u="scrollend",h="scroll",d="panend",g="panstart",y="pan",_="scrollanimate",v="scaleanimate",p="scale",m="afterrender",b="refresh",C=5e-4,x=300,w="ease-in-out",S=.1,T=.36,X=300,Y=i.prefixStyle("transform"),E=i.prefixStyle("transition"),k=i.prefixStyle("transitionDuration"),H=i.prefixStyle("transformOrigin"),A=i.vendor?i.prefixStyle("transitionEnd"):"transitionend",N=i.vendor?["-",i.vendor,"-transform"].join(""):"transform",O=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},P=["webkit","moz","ms","o"],W=window.cancelAnimationFrame,B=0;B<P.length;B++)(window[P[B]+"CancelAnimationFrame"]||window[P[B]+"CancelRequestAnimationFrame"])&&(W=window[P[B]+"CancelAnimationFrame"]||window[P[B]+"CancelRequestAnimationFrame"]);W=W||window.clearTimeout;var z=function(t,e){if(!(t.touches.length>1)){var n=t.changedTouches,i=n[0],r=document.createEvent("MouseEvent");r.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(r)}};return i.mix(f.prototype,{init:function(){var t=this;t.__events={};var e=t.userConfig=i.mix({scalable:!1,scrollbarX:!0,scrollbarY:!0,gpuAcceleration:!0},t.userConfig,void 0,void 0,!0);t.renderTo=e.renderTo.nodeType?e.renderTo:document.querySelector(e.renderTo),t.scale=e.scale||1,t.boundryCheckEnabled=!0;var n=t.clsPrefix=e.clsPrefix||"xs-";t.SROLL_ACCELERATION=e.SROLL_ACCELERATION||C,t.containerClsName=n+"container",t.contentClsName=n+"content"},refresh:function(){var t=this;t.render(),t.scrollTo({x:0,y:0}),t.fire(b)},render:function(){var t=this,e=t.userConfig;t._createContainer();var n=e.width||t.renderTo.offsetWidth,i=e.height||t.renderTo.offsetHeight||0;t.width=n,t.height=i;var r=e.containerWidth||t.content.offsetWidth,o=e.containerHeight||t.content.offsetHeight;t.containerWidth=r<t.width?t.width:r,t.containerHeight=o<t.height?t.height:o,t.initialContainerWidth=t.containerWidth,t.initialContainerHeight=t.containerHeight;var a=t.userConfig.minScale||Math.max(t.width/t.containerWidth,t.height/t.containerHeight),s=t.userConfig.maxScale||1;t.minScale=a,t.maxScale=s,t.boundry={reset:function(){return this.resetTop(),this.resetLeft(),this.resetBottom(),this.resetRight(),this},resetTop:function(){return this.top=0,this},resetLeft:function(){return this.left=0,this},resetBottom:function(){return this.bottom=t.height,this},resetRight:function(){return this.right=t.width,this},expandTop:function(t){return this.top+=t||0,this},expandLeft:function(t){return this.left+=t||0,this},expandRight:function(t){return this.right-=t||0,this},expandBottom:function(t){return this.bottom-=t||0,this}},t.boundry.reset(),t.fire(m),t.renderScrollBars(),t._bindEvt()},renderScrollBars:function(){var t=this;t.userConfig.scrollbarX&&(t.scrollbarX?t.scrollbarX._update():t.scrollbarX=new c({xscroll:t,type:"x"})),t.userConfig.scrollbarY&&(t.scrollbarY?t.scrollbarY._update():t.scrollbarY=new c({xscroll:t,type:"y"}))},_createContainer:function(){var t=this;if(!t.__isContainerCreated){var e=(t.renderTo,t.container=t.renderTo.getElementsByClassName(t.containerClsName)[0]),n=t.content=t.renderTo.getElementsByClassName(t.contentClsName)[0];e.style.position="absolute",e.style.height="100%",e.style.width="100%",e.style[H]="0 0",n.style.position="absolute",n.style[H]="0 0",t.translate({x:0,y:0}),t.__isContainerCreated=!0}},translate:function(t){this.translateX(t.x),this.translateY(t.y)},_scale:function(t,e,n,i){var r=this;if(r.userConfig.scalable&&r.scale!=t&&t){r.isScaling||(r.scaleBegin=r.scale,r.isScaling=!0,r.scaleBeginX=r.x,r.scaleBeginY=r.y),e&&(r.originX=e),n&&(r.originY=n);var o=r.boundry,a=t*r.initialContainerWidth,s=t*r.initialContainerHeight;r.containerWidth=Math.round(a>r.width?a:r.width),r.containerHeight=Math.round(s>r.height?s:r.height),r.scale=t;var c=e*(r.initialContainerWidth*r.scaleBegin-r.containerWidth)+r.scaleBeginX,l=n*(r.initialContainerHeight*r.scaleBegin-r.containerHeight)+r.scaleBeginY;c>o.left&&(c=o.left),l>o.top&&(l=o.top),c<o.right-r.containerWidth&&(c=o.right-r.containerWidth),l<o.bottom-r.containerHeight&&(l=o.bottom-r.containerHeight),r.x=c,r.y=l,r._transform(),r.fire(p,{scale:t,origin:{x:e,y:n},triggerEvent:i})}},scaleTo:function(t,e,n,i,r){var o=this;if(o.userConfig.scalable&&o.scale!=t&&t){var i=i||1,r=r||"ease-out",a=[N," ",i/1e3,"s ",r," 0s"].join(""),s=Date.now();o.destTimeScale=s+i,W(o._rafScale);var c=(o.scale,function(){var t=Date.now();return t>s+i&&t>=o.destTimeScale?void(o.isScaling=!1):void(o._rafScale=O(c))});c(),o.container.style[E]=a,o.content.style[E]=a,o._scale(t,e,n,"scaleTo"),o.fire(v,{scale:o.scale,duration:i,easing:r,offset:{x:o.x,y:o.y},origin:{x:e,y:n}})}},translateX:function(t){this.x=t,this._transform()},translateY:function(t){this.y=t,this._transform()},_noTransition:function(){var t=this;i.isBadAndroid?(t.content.style[k]="0.001s",t.container.style[k]="0.001s"):(t.content.style[E]="none",t.container.style[E]="none")},stop:function(){var t=this;if(!t.isScaling){var e=t.boundry,n=t.getOffset();n.y>e.top||n.y+t.containerHeight<e.bottom||n.x>e.left||n.x+t.containerWidth<e.right||(t.translate(n),t._noTransition(),W(t.rafX),W(t.rafY),t.fire(u,{offset:n,scale:t.scale,zoomType:"xy"}))}},enableGPUAcceleration:function(){this.userConfig.gpuAcceleration=!0},disableGPUAcceleration:function(){this.userConfig.gpuAcceleration=!1},_transform:function(){var t=this.userConfig.gpuAcceleration?" translateZ(0) ":"";this.content.style[Y]="translate("+this.x+"px,0px)  scaleX("+this.scale+") scaleY("+this.scale+") "+t,this.container.style[Y]="translate(0px,"+this.y+"px) "+t},getOffset:function(){var t=this;return{x:t.getOffsetLeft(),y:t.getOffsetTop()}},getOffsetTop:function(){if(this.lockY)return 0;var t=window.getComputedStyle(this.container)[Y].match(/[-\d\.*\d*]+/g);return t?Math.round(t[5]):0},getOffsetLeft:function(){if(this.lockX)return 0;var t=window.getComputedStyle(this.content)[Y].match(/[-\d\.*\d*]+/g);return t?Math.round(t[4]):0},scrollTo:function(t,e,n,i){var r=this,o=r.getOffset(),a=void 0===t.x||isNaN(t.x)?-o.x:t.x,s=void 0===t.y||isNaN(t.y)?-o.y:t.y;r.scrollX(a,e,n,i),r.scrollY(s,e,n,i)},scrollX:function(t,e,n,i){var r=this,t=Math.round(t);if(!r.userConfig.lockX){var e=e||0,n=n||"cubic-bezier(0.333333, 0.666667, 0.666667, 1)",o=r.content;r.translateX(-t);var a=e>0?[N," ",e/1e3,"s ",n," 0s"].join(""):"none";return o.style[E]=a,r._scrollHandler(-t,e,i,n,a,"x"),o.style[E]=a}},scrollY:function(t,e,n,i){var r=this,t=Math.round(t);if(!r.userConfig.lockY){var e=e||0,n=n||"cubic-bezier(0.333333, 0.666667, 0.666667, 1)",o=r.container;r.translateY(-t);var a=e>0?[N," ",e/1e3,"s ",n," 0s"].join(""):"none";return o.style[E]=a,r._scrollHandler(-t,e,i,n,a,"y"),o.style[E]=a}},_scrollHandler:function(t,e,n,i,r,o){var a=this,s=a.getOffset();if(0>=e)return a.fire(h,{zoomType:o,offset:s}),void a.fire(u,{zoomType:o,offset:s});var c=o.toUpperCase();a["isScrolling"+c]=!0;var l=Date.now();a["destTime"+c]=l+e,W(a["raf"+c]),a["__scrollEndCallback"+c]=function(t){a["isScrolling"+c]=!1,a.fire(u,{offset:a.getOffset(),zoomType:t.type}),n&&n(t)};var f=function(){Date.now();a["isScrolling"+c]&&O(function(){a.fire(h,{zoomType:o,offset:a.getOffset()})},0),a["raf"+c]=O(f)};f(),a.fire(_,{transition:r,offset:{x:a.x,y:a.y},duration:e/1e3,easing:i,zoomType:o})},boundryCheckX:function(t){var e=this;if(e.boundryCheckEnabled&&!e.userConfig.lockX){var n=e.getOffset(),i=e.containerWidth,r=e.boundry;n.x>r.left?(n.x=r.left,e.scrollX(-n.x,x,w,t)):n.x+i<r.right&&(n.x=r.right-i,e.scrollX(-n.x,x,w,t))}},boundryCheckY:function(t){var e=this;if(e.boundryCheckEnabled&&!e.userConfig.lockY){var n=e.getOffset(),i=e.containerHeight,r=e.boundry;n.y>r.top?(n.y=r.top,e.scrollY(-n.y,x,w,t)):n.y+i<r.bottom&&(n.y=r.bottom-i,e.scrollY(-n.y,x,w,t))}},boundryCheck:function(t){this.boundryCheckX(t),this.boundryCheckY(t)},bounce:function(t,e){this.boundryCheckEnabled=t,t?this.boundryCheck(e):void 0},_fireTouchStart:function(t){this.fire("touchstart",t)},_firePanStart:function(t){this.fire(g,t)},_firePan:function(t){this.fire(y,t)},_firePanEnd:function(t){this.fire(d,t)},_fireClick:function(t,e){this.fire(t,e)},_bindEvt:function(){var t=this;if(!t.__isEvtBind){t.__isEvtBind=!0;var e=t.renderTo,c=t.container,l=t.content,f=t.containerWidth,u=t.containerHeight,d={x:0,y:0},g=t.boundry;if(r.on(e,"touchstart",function(e){e.preventDefault(),t._fireTouchStart(e),t.stop()}).on(e,a.TAP,function(e){t.boundryCheck(),t.isScrollingX||t.isScrollingY?(t.isScrollingX=!1,t.isScrollingY=!1,t.stop()):(z(e,"click"),t._fireClick("click",e))}).on(e,o.PAN_START,function(e){d=t.getOffset(),t.translate(d),t._firePanStart(i.mix(e,{offset:d}))}).on(e,o.PAN,function(e){var n=t.userConfig.lockY?Number(d.y):Number(d.y)+e.deltaY,r=t.userConfig.lockX?Number(d.x):Number(d.x)+e.deltaX;f=t.containerWidth,u=t.containerHeight,n>g.top&&(n=(n-g.top)*T+g.top),n<g.bottom-u&&(n+=(g.bottom-u-n)*T),r>g.left&&(r=(r-g.left)*T+g.left),r<g.right-f&&(r+=(g.right-f-r)*T),t.translate({x:r,y:n}),t._noTransition(),t.isScrollingX=!1,t.isScrollingY=!1,t.directionX=e.directionX,t.directionY=e.directionY;var o=i.mix(e,{offset:{x:r,y:n},directionX:t.directionX,directionY:t.directionY});t.fire(h,o),t._firePan(o)}).on(e,o.PAN_END,function(e){t.panEndHandler(e),t._firePanEnd(e)}),r.on(c,A,function(e){e.target!=l||t.isScaling||t.__scrollEndCallbackX&&t.__scrollEndCallbackX({type:"x"}),e.target!=c||t.isScaling||t.__scrollEndCallbackY&&t.__scrollEndCallbackY({type:"y"})},!1),t.userConfig.scalable){var y,_;r.on(e,s.PINCH_START,function(e){scale=t.scale,y=(e.origin.pageX-t.x)/t.containerWidth,_=(e.origin.pageY-t.y)/t.containerHeight}),r.on(e,s.PINCH,function(e){t._scale(scale*e.scale,y,_,"pinch")}),r.on(e,s.PINCH_END,function(){t.isScaling=!1,t.scale<t.minScale?t.scaleTo(t.minScale,y,_,X):t.scale>t.maxScale&&t.scaleTo(t.maxScale,y,_,X)}),r.on(e,a.DOUBLE_TAP,function(e){y=(e.pageX-t.x)/t.containerWidth,_=(e.pageY-t.y)/t.containerHeight,t.scale>t.minScale?t.scaleTo(t.minScale,y,_,200):t.scaleTo(t.maxScale,y,_,200)})}r.on(n,"resize",function(){t.refresh()})}},panEndHandler:function(t){var e,n=this,i=(n.userConfig,n.getOffset()),r=n._bounce("x",i.x,t.velocityX,n.width,n.containerWidth),o=n._bounce("y",i.y,t.velocityY,n.height,n.containerHeight),a=r?r.offset:0,s=o?o.offset:0;r&&o&&r.status&&o.status&&r.duration&&o.duration&&(e=Math.max(r.duration,o.duration)),r&&(r.duration<100?n._scrollEndHandler("x"):n.scrollX(a,e||r.duration,r.easing,function(){n._scrollEndHandler("x")})),o&&(o.duration<100?n._scrollEndHandler("y"):n.scrollY(s,e||o.duration,o.easing,function(){n._scrollEndHandler("y")})),n.directionX=t.velocityX<0?"left":"right",n.directionY=t.velocityY<0?"up":"down"},_scrollEndHandler:function(t){var n=this,i=t.toUpperCase(),r="scroll"+i,o="boundryCheck"+i,a="_bounce"+t;if(n[a]){n.fire("outOfBoundry");var s=n[a],c=.04*(s/Math.abs(s)),l=s/c,f=n.getOffset()[t],u=f+l*s/2;n[r](-u,l,"cubic-bezier("+e(-l,0)+")",function(){n[a]=0,n[o]()})}else n[o]()},fire:function(t){var e=this;if(e.__events[t]&&e.__events[t].length)for(var n in e.__events[t])e.__events[t][n].apply(this,[].slice.call(arguments,1))},on:function(t,e){this.__events[t]||(this.__events[t]=[]),this.__events[t].push(e)},detach:function(t,e){if(t&&this.__events[t]){var n=this.__events[t].indexOf(e);n>-1&&this.__events[t].splice(n,1)}},_bounce:function(t,n,i,r,o){var a=this,s=a.boundry,c="x"==t?s.left:s.top,l="x"==t?s.right:s.bottom,r=l-c,f={};if(0===i)return void("x"==t?a.boundryCheckX():a.boundryCheckY());if(!("x"==t&&a.userConfig.lockX||"y"==t&&a.userConfig.lockY)){var u=a.userConfig,h=u.maxSpeed>0&&u.maxSpeed<6?u.maxSpeed:3;if(i>h&&(i=h),-h>i&&(i=-h),n>c||r-o>n){var d=S*(i/Math.abs(i)),g=i/d,y=n+g*i/2;return f.offset=-y,f.duration=g,f.easing="cubic-bezier("+e(-g,0)+")",f}var d=a.SROLL_ACCELERATION*(i/Math.abs(i)),g=i/d,y=n/1+g*i/2;if(y>c){var _=c-n,v=(i-Math.sqrt(-2*d*_+i*i))/d;f.offset=-c,f.duration=v,f.easing="cubic-bezier("+e(-g,-g+v)+")",a["_bounce"+t]=i-d*v}else if(r-o>y){var _=r-o-n,v=(i+Math.sqrt(-2*d*_+i*i))/d;f.offset=o-r,f.duration=v,f.easing="cubic-bezier("+e(-g,-g+v)+")",a["_bounce"+t]=i-d*v}else f.offset=-y,f.duration=g,f.easing="cubic-bezier("+e(-g,0)+")",f.status="normal";return a["isScrolling"+t.toUpperCase()]=!0,f}},plug:function(t){var e=this;t&&t.pluginId&&(e.__plugins||(e.__plugins=[]),t.initializer(e),e.__plugins.push(t))},unplug:function(t){var e=this;if(t){var n="string"==typeof t?e.getPlugin(t):t;for(var i in e.__plugins)if(e.__plugins[i]==n)return e.__plugins[i].splice(i,1)}},getPlugin:function(t){var e=this,n=[];for(var i in e.__plugins)e.__plugins[i]&&e.__plugins[i].pluginId==t&&n.push(e.__plugins[i]);return n.length>1?n:n[0]||null}}),window.XScroll=f,f});});