KISSY.add('kg/xscroll/2.0.0/pulldown',["./util"],function(S ,require, exports, module) {define(function(n){var e,t=n("./util"),o="Pull Down To Refresh",i="Loading...",s=function(n){this.init(n)};return t.mix(s.prototype,{init:function(n){var s=this;s.__events={},s.userConfig=t.mix({content:o,height:60,autoRefresh:!0,downContent:"Pull Down To Refresh",upContent:"Release To Refresh",loadingContent:i,prefix:"xs-plugin-pulldown-"},n),s.xscroll=s.userConfig.xscroll,e=s.userConfig.prefix,s.xscroll&&s.xscroll.on("afterrender",function(){s.render()})},destroy:function(){var n=this;n.pulldown&&n.pulldown.remove(),n.xscroll.detach("panstart",n._panStartHandler,n),n.xscroll.detach("pan",n._panHandler,n),n.xscroll.detach("panend",n._panEndHandler,n),delete n},render:function(){var n=this;if(!n.__isRender){n.__isRender=!0;var o=e+"container",i=n.userConfig.height||60,s=n.pulldown=document.createElement("div");s.className=o,s.style.position="absolute",s.style.width="100%",s.style.height=i+"px",s.style.top=-i+"px",n.xscroll.container.appendChild(s),t.addClass(s,e+n.status),s.innerHTML=n.userConfig[n.status+"Content"]||n.userConfig.content,n._bindEvt()}},_bindEvt:function(){var n=this;if(!n._evtBinded){n._evtBinded=!0;var e=(n.pulldown,n.xscroll);e.on("pan",function(e){n._panHandler(e)}),e.on("panstart",function(e){n._panStartHandler(e)}),e.on("panend",function(e){n._panEndHandler(e)})}},_changeStatus:function(n){var o=this.status;this.status=n,t.removeClass(this.pulldown,e+o),t.addClass(this.pulldown,e+n),this.setContent(this.userConfig[n+"Content"]),o!=n&&(this.fire("statuschange",{prevVal:o,newVal:n}),"loading"==n&&this.fire("loading"))},fire:function(n){var e=this;if(e.__events[n]&&e.__events[n].length)for(var t in e.__events[n])e.__events[n][t].apply(this,[].slice.call(arguments,1))},on:function(n,e){this.__events[n]||(this.__events[n]=[]),this.__events[n].push(e)},detach:function(n,e){if(n&&this.__events[n]){var t=this.__events[n].indexOf(e);t>-1&&this.__events[n].splice(t,1)}},reset:function(n){var e=this,t=(e.userConfig.height||60,e.xscroll);t.boundry.resetTop(),t.bounce(!0,n),e._expanded=!1},_panStartHandler:function(){clearTimeout(this.loadingItv)},_panHandler:function(n){var e=this,t=n.offset.y,o=e.userConfig.height||60;0>t||e._changeStatus(Math.abs(t)<o?"down":"up")},_panEndHandler:function(){var n=this,e=n.xscroll,t=e.boundry.top,o=n.userConfig.height||60,i=e.getOffsetTop();i>o&&(e.boundry.top=t,!n._expanded&&e.boundry.expandTop(o),n._expanded=!0,e.bounce(!0,function(){n._changeStatus("loading")}),n.userConfig.autoRefresh&&(clearTimeout(n.loadingItv),n.loadingItv=setTimeout(function(){e.boundry.expandTop(-o),e.bounce(!0,function(){window.location.reload()})},800)))},setContent:function(n){var e=this;n&&(e.pulldown.innerHTML=n)}}),s});});