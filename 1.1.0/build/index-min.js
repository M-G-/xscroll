/*!build time : 2014-08-01 10:21:34 AM*/
KISSY.add("kg/xscroll/1.1.0/index",function(a,b,c,d,e,f,g){function h(a,b){return[[(a/3+(a+b)/3-a)/(b-a),(a*a/3+a*b*2/3-a*a)/(b*b-a*a)],[(b/3+(a+b)/3-a)/(b-a),(b*b/3+a*b*2/3-a*a)/(b*b-a*a)]]}var i,j,k,l=a.all,m="scrollEnd",n="scroll",o="panEnd",p="panStart",q="pan",r="scrollAnimate",s="scaleAnimate",t="scale",u="afterRender",v="refresh",w=5e-4,x=300,y="ease-in-out",z=.1,A=.36,B=300,C=g.prefixStyle("transform"),D=g.prefixStyle("transition"),E=g.prefixStyle("transitionDuration"),F=g.prefixStyle("transformOrigin"),G=g.vendor?["-",g.vendor,"-transform"].join(""):"transform",H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},I=d.extend({initializer:function(){var b=this,c=b.userConfig=a.mix({autoRender:!0,scalable:!1},b.userConfig,void 0,void 0,!0);b.$renderTo=l(c.renderTo).css({overflowY:"hidden"}),i=c.clsPrefix||"ks-xscroll-",b.SROLL_ACCELERATION=c.SROLL_ACCELERATION||w,j=i+"container",k=i+"content",c.autoRender&&b.render()},refresh:function(){var a=this;a.render(),a.scrollTo({x:0,y:0}),a.fire(v)},render:function(){var a=this,b=a.userConfig;a._createContainer();var c=b.height||a.$renderTo.height(),d=b.width||a.$renderTo.width();a.set("width",d),a.set("height",c),a.set("scale",b.scale||1);var e=b.containerWidth||a.$content.width(),f=b.containerHeight||a.$content.height();a.set("containerWidth",e<a.get("width")?a.get("width"):e),a.set("containerHeight",f<a.get("height")?a.get("height"):f),a.set("initialContainerWidth",a.get("containerWidth")),a.set("initialContainerHeight",a.get("containerHeight"));var g=a.userConfig.minScale||Math.max(a.get("width")/a.get("containerWidth"),a.get("height")/a.get("containerHeight")),h=a.userConfig.maxScale||1;a.set("minScale",g),a.set("maxScale",h),a.boundry={reset:function(){return this.left=0,this.top=0,this.right=a.get("width"),this.bottom=a.get("height"),this},expandTop:function(a){return this.top+=a||0,this},expandLeft:function(a){return this.left+=a||0,this},expandRight:function(a){return this.right-=a||0,this},expandBottom:function(a){return this.bottom-=a||0,this}},a.boundry.reset(),a.fire(u),a._bindEvt()},_createContainer:function(){var a=this;if(!a.__isContainerCreated){var b=(a.$renderTo,l("."+j,a.$renderTo)[0]),c=l("."+k,a.$renderTo)[0];a.$ctn=l(b),a.$content=l(c),b.style.position="absolute",b.style.height="100%",b.style.width="100%",c.style.position="absolute",b.style[F]="0 0",c.style[F]="0 0",a.translate({x:0,y:0}),a.__isContainerCreated=!0}},translate:function(a){this.translateX(a.x),this.translateY(a.y)},scaleTo:function(a,b,c,d,e){var f=this,g="";if(f.userConfig.scalable&&f.get("scale")!=a&&a){if(f.scale(a,b,c),d){var e=e||"ease-out";g=[G," ",d/1e3,"s ",e," 0s"].join(""),f.fire(s,{scale:f.get("scale"),duration:d,easing:e,offset:{x:f.get("x"),y:f.get("y")}})}f.$ctn[0].style[D]=g,f.$content[0].style[D]=g}},scale:function(a,b,c){var d=this;if(d.userConfig.scalable&&d.get("scale")!=a&&a){b&&d.set("originX",b),c&&d.set("originY",c);var e=d.boundry,f=a*d.get("initialContainerWidth"),g=a*d.get("initialContainerHeight");d.set("containerWidth",f>d.get("width")?f:d.get("width")),d.set("containerHeight",g>d.get("height")?g:d.get("height")),d.set("scale",a);var h=-b*d.get("containerWidth")+d.get("width")/2,i=-c*d.get("containerHeight")+d.get("height")/2;h>e.left&&(h=e.left),i>e.top&&(i=e.top),h<e.right-d.get("containerWidth")&&(h=e.right-d.get("containerWidth")),i<e.bottom-d.get("containerHeight")&&(i=e.bottom-d.get("containerHeight")),d.set("x",h),d.set("y",i),d._transform(),d.fire(t,{scale:a})}},translateX:function(a){this.set("x",a),this._transform()},translateY:function(a){this.set("y",a),this._transform()},stop:function(){var a=this.getOffset();this.translate(a),g.isAndroid?(this.$content[0].style[E]="0.001s",this.$ctn[0].style[E]="0.001s"):(this.$content[0].style[D]="none",this.$ctn[0].style[D]="none")},_transform:function(){this.$content[0].style[C]="translate("+(this.get("x")||0)+"px,0px) translateZ(0) scaleX("+this.get("scale")+")",this.$ctn[0].style[C]="translate(0px,"+(this.get("y")||0)+"px) translateZ(0) scaleY("+this.get("scale")+")"},getOffset:function(){var a=window.getComputedStyle(this.$content[0])[C].match(/[-\d\.*\d*]+/g),b=window.getComputedStyle(this.$ctn[0])[C].match(/[-\d\.*\d*]+/g);return{x:a?Number(a[4]):0,y:b?Number(b[5]):0}},getOffsetTop:function(){var a=window.getComputedStyle(this.$ctn[0])[C].match(/[-\d\.*\d*]+/g);return a?Number(a[5]):0},getOffsetLeft:function(){var a=window.getComputedStyle(this.$content[0])[C].match(/[-\d\.*\d*]+/g);return a?Number(a[4]):0},scrollTo:function(a,b,c,d){var e=this,f=e.getOffset(),g=void 0===a.x||isNaN(a.x)?-f.x:a.x,h=void 0===a.y||isNaN(a.y)?-f.y:a.y;e.scrollX(g,b,c,d),e.scrollY(h,b,c,d)},scrollX:function(a,b,c,d){var e=this;if(!e.get("lockX")){var b=b||20,f=e.$content[0];e.translateX(-a);var g=[G," ",b/1e3,"s ",c," 0s"].join("");return e._scrollHandler(a,b,d,c,g,"x"),f.style[D]=g}},scrollY:function(a,b,c,d){var e=this;if(!e.get("lockY")){var b=b||20,f=e.$ctn[0];e.translateY(-a);var g=[G," ",b/1e3,"s ",c," 0s"].join("");return e._scrollHandler(a,b,d,c,g,"y"),f.style[D]=g,f.style.webkitTransition=g,f.style[D]=g}},_scrollHandler:function(a,b,c,d,e,f){var g=this;if(!(0>=b)){var h=f.toUpperCase();g["isScrolling"+h]=!0;var i=Date.now();g["destTime"+h]=i+b;var j=function(){var a=Date.now();return a>i+b&&a>=g["destTime"+h]?(g["isScrolling"+h]=!1,g.fire(n,{offset:g.getOffset(),zoomType:f}),void(c&&c({type:f}))):(g["isScrolling"+h]&&H(function(){g.fire(n,{zoomType:f,offset:g.getOffset()})},0),void H(j))};j(),g.fire(r,{transition:e,offset:a,duration:b/1e3,easing:d,direction:f})}},boundryCheckX:function(){var a=this;if(a.get("boundryCheckEnabled")&&!a.get("lockX")){var b=a.getOffset(),c=(a.get("width"),a.get("containerWidth")),d=a.boundry;b.x>d.left?(b.x=d.left,a.scrollX(-b.x,x,y)):b.x+c<d.right&&(b.x=d.right-c,a.scrollX(-b.x,x,y))}},boundryCheckY:function(){var a=this;if(a.get("boundryCheckEnabled")&&!a.get("lockY")){var b=a.getOffset(),c=(a.get("height"),a.get("containerHeight")),d=a.boundry;b.y>d.top?(b.y=d.top,a.scrollY(-b.y,x,y)):b.y+c<d.bottom&&(b.y=d.bottom-c,a.scrollY(-b.y,x,y))}},boundryCheck:function(){var a=this;a.boundryCheckX(),a.boundryCheckY()},bounce:function(a){var b=this;b.set("boundryCheckEnabled",a),a?b.boundryCheck():void 0},_bindEvt:function(){var a=this;if(!a.__isEvtBind){a.__isEvtBind=!0;var b=a.$renderTo,c=(a.$ctn[0],a.$content[0],a.get("containerWidth")),d=a.get("containerHeight"),g={x:0,y:0},h=a.boundry;b.on("touchstart",function(b){b.preventDefault(),a.stop()}).on("tap",function(){a.boundryCheck()}).on(e.PAN_START,function(){g=a.getOffset(),a.translate(g),a.fire(p,{offset:g})}).on(e.PAN,function(b){var e=a.get("lockY")?Number(g.y):Number(g.y)+b.deltaY,f=a.get("lockX")?Number(g.x):Number(g.x)+b.deltaX;h=a.boundry,c=a.get("containerWidth"),d=a.get("containerHeight"),e>h.top&&(e*=A),e<h.bottom-d&&(e+=(h.bottom-d-e)*A),f>h.left&&(f*=A),f<h.right-c&&(f+=(h.right-c-f)*A),a.translate({x:f,y:e}),a.isScrollingX=!1,a.isScrollingY=!1,a.fire(n,{offset:{x:f,y:e}}),a.fire(q,{offset:g})}).on(e.PAN_END,function(b){a.panEndHandler(b),a.fire(o,{velocity:b.velocity,velocityX:b.velocityX,velocityY:b.velocityY})});if(a.userConfig.scalable){var i,j;a.$renderTo.on(f.PINCH_START,function(b){scale=a.get("scale"),i=(b.origin.pageX-a.get("x"))/a.get("containerWidth"),j=(b.origin.pageY-a.get("y"))/a.get("containerHeight")}),a.$renderTo.on(f.PINCH,function(b){a.get("scale")<=a.get("minScale")?a.scaleTo(scale*b.scale,i,j):a.scaleTo(scale*b.scale,i,j)}),a.$renderTo.on(f.PINCH_END,function(){a.get("scale")<a.get("minScale")?a.scaleTo(a.get("minScale"),i,j,B):a.get("scale")>a.get("maxScale")&&a.scaleTo(a.get("maxScale"),i,j,B)})}window.addEventListener("resize",function(){a.refresh()})}},panEndHandler:function(a){var b=this,c=(b.userConfig,b.getOffset());if(Math.abs(a.velocity)<.5)return b.fire(m,{offset:c}),void b.boundryCheck();var d,e=b._bounce("x",c.x,a.velocityX,b.get("width"),b.get("containerWidth")),f=b._bounce("y",c.y,a.velocityY,b.get("height"),b.get("containerHeight")),g=e?e.offset:0,h=f?f.offset:0;e&&f&&e.status&&f.status&&e.duration&&f.duration&&(d=Math.max(e.duration,f.duration)),e&&b.scrollX(g,d||e.duration,e.easing,function(){b._scrollEndHandler("x")}),f&&b.scrollY(h,d||f.duration,f.easing,function(){b._scrollEndHandler("y")}),b.set("directionX",a.velocityX<0?"left":"right"),b.set("directionY",a.velocityY<0?"up":"down")},_scrollEndHandler:function(a){var b=this;if(b["_bounce"+a]){b.fire("outOfBoundry");var c=b["_bounce"+a],d=.04*(c/Math.abs(c)),e=c/d,f=b.getOffset()[a],g=f+e*c/2;"x"==a?b.scrollX(-g,e,"cubic-bezier("+h(-e,0)+")",function(){b["_bounce"+a]=0,b.boundryCheckX()}):b.scrollY(-g,e,"cubic-bezier("+h(-e,0)+")",function(){b["_bounce"+a]=0,b.boundryCheckY()})}else"x"==a?b.boundryCheckX():"y"==a&&b.boundryCheckY()},_bounce:function(a,b,c,d,e){var f=this,g=f.boundry,i=(g[a],"x"==a?g.w:g.h,{});if(0===c)return void("x"==a?f.boundryCheckX():f.boundryCheckY());if(!("x"==a&&f.get("lockX")||"y"==a&&f.get("lockY"))){var j=f.userConfig,k=j.maxSpeed>0&&j.maxSpeed<6?j.maxSpeed:3;if(c>k&&(c=k),-k>c&&(c=-k),b>0||d-e>b){var l=z*(c/Math.abs(c)),m=c/l,n=b+m*c/2;return i.offset=-n,i.duration=m,i.easing="cubic-bezier("+h(-m,0)+")",i}var l=f.SROLL_ACCELERATION*(c/Math.abs(c)),m=c/l,n=b/1+m*c/2;if(n>0){var o=0-b,p=(c-Math.sqrt(-2*l*o+c*c))/l;i.offset=0,i.duration=p,i.easing="cubic-bezier("+h(-m,-m+p)+")",f["_bounce"+a]=c-l*p}else if(d-e>n){var o=d-e-b,p=(c+Math.sqrt(-2*l*o+c*c))/l;i.offset=e-d,i.duration=p,i.easing="cubic-bezier("+h(-m,-m+p)+")",f["_bounce"+a]=c-l*p}else i.offset=-n,i.duration=m,i.easing="cubic-bezier("+h(-m,0)+")",i.status="normal";return f["isScrolling"+a.toUpperCase()]=!0,i}}},{ATTRS:{width:{value:0},height:{value:0},lockX:{value:!1},lockY:{value:!1},containerWidth:{value:0},containerHeight:{value:0},boundryCheckEnabled:{value:!0},directionY:{value:""},directionX:{value:""},originX:{value:0},originY:{value:0}}});return I},{requires:["node","event","base","kg/xscroll/1.1.0/pan","kg/xscroll/1.1.0/pinch","kg/xscroll/1.1.0/util"]});