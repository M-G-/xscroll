/*!build time : 2014-10-11 11:10:04 AM*/
KISSY.add("kg/xscroll/1.1.8/plugin/pulldown",function(a,b){var c,d=a.all,e="Pull Down To Refresh",f="Loading...",g=b.extend({pluginId:"xscroll/plugin/pulldown",pluginInitializer:function(b){var d=this;d.userConfig=a.merge({content:e,autoRefresh:!0,downContent:"Pull Down To Refresh",upContent:"Release To Refresh",loadingContent:f,prefix:"ks-xscroll-plugin-pulldown-"},d.userConfig),d.xscroll=b,c=d.userConfig.prefix,d.xscroll&&d.xscroll.on("afterRender",function(){d.render()})},pluginDestructor:function(){var a=this;a.$pulldown&&a.$pulldown.remove(),a.detach("afterStatusChange"),a.xscroll.detach("panStart",a._panStartHandler,a),a.xscroll.detach("pan",a._panHandler,a),a.xscroll.detach("panEnd",a._panEndHandler,a),delete a},render:function(){var a=this;if(!a.__isRender){a.__isRender=!0;var b=c+"container",e='<div class="'+b+'"></div>',f=a.userConfig.height||60,g=a.$pulldown=d(e).css({position:"absolute",width:"100%",height:f,top:-f}).prependTo(a.xscroll.$ctn);g.addClass(c+a.get("status")),g.html(a.userConfig[a.get("status")+"Content"]||a.userConfig.content),a._bindEvt()}},_bindEvt:function(){var a=this;if(!a._evtBinded){a._evtBinded=!0;var b=a.$pulldown,d=a.xscroll;d.on("pan",a._panHandler,a),a.on("afterStatusChange",function(d){b.removeClass(c+d.prevVal).addClass(c+d.newVal),a.setContent(a.userConfig[d.newVal+"Content"])}),d.on("panStart",a._panStartHandler,a),d.on("panEnd",a._panEndHandler,a)}},_panStartHandler:function(){clearTimeout(this.loadingItv)},_panHandler:function(a){var b=this,c=a.offset.y,d=b.userConfig.height||60;0>c||(Math.abs(c)<d?b.set("status","down"):b.set("status","up"))},_panEndHandler:function(){var a=this,b=a.xscroll,c=b.boundry.top,d=a.userConfig.height||60,e=b.getOffsetTop();e>d&&(b.boundry.top=c,!a._expanded&&b.boundry.expandTop(d),a._expanded=!0,b.bounce(!0),a.set("status","loading"),clearTimeout(a.loadingItv),a.loadingItv=setTimeout(function(){b.boundry.expandTop(-d),b.bounce(!0,function(){a.fire("refresh"),a.userConfig.autoRefresh&&window.location.reload()})},800))},setContent:function(a){var b=this;a&&b.$pulldown.html(a)}},{ATTRS:{status:{value:"down"}}});return g},{requires:["base","node"]});